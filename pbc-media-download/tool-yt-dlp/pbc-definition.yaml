# Media Download PBC Definition
# Packaged Business Capability for media acquisition from web sources

pbc_name: "Media Download"
version: "0.1.0"
status: "experimental"
created: "2025-12-12"

description: |
  Media acquisition from web sources - video, audio, and metadata extraction.
  Uses yt-dlp to download from YouTube and 700+ other sites.
  Designed to feed content into rag-pipeline for transcription and indexing.

# Core tools in this PBC's venv
tools:
  yt-dlp:
    purpose: "Media downloading and extraction"
    version: "latest"
    access:
      cli: "yt-dlp"
      python: ".venv"
    capabilities:
      - "Video/audio download from 700+ sites"
      - "Format selection and conversion"
      - "Metadata extraction (100+ fields)"
      - "Playlist/channel batch downloads"
      - "Subtitle extraction"
      - "Thumbnail embedding"

# External dependencies
dependencies:
  ffmpeg:
    purpose: "Media processing (merging, conversion, audio extraction)"
    install: "winget install ffmpeg"
    required: true

# What goes in, what comes out
interfaces:
  inputs:
    - url: "Video/playlist/channel URL"
    - format: "Video/audio format preference"
    - options: "Quality, subtitles, metadata flags"
  outputs:
    - media_file: "Downloaded video/audio file"
    - metadata: "JSON metadata (title, duration, description, etc.)"
    - subtitles: "SRT/VTT subtitle files (if available)"
    - thumbnail: "Video thumbnail image"

# Reusable scripts inventory
scripts:
  download_youtube:
    file: "scripts/download_youtube.py"
    status: "active"
    description: "Full YouTube download with format selection and metadata"
    use_cases:
      - "Download YouTube videos for RAG pipeline"
      - "Extract audio for transcription"
      - "Get video metadata for indexing"
    inputs:
      - url: "YouTube video or playlist URL"
      - format: "Video format or 'audio-only'"
      - output_dir: "Output directory (default: downloads/)"
    outputs:
      - media_file: "Downloaded video/audio file"
      - metadata_json: "Sidecar .info.json file with full metadata"

  batch_download:
    file: "scripts/batch_download.py"
    status: "stub"
    description: "Download from URL list file"
    use_cases:
      - "Batch processing research videos"
      - "Downloading course content"

  extract_metadata:
    file: "scripts/extract_metadata.py"
    status: "stub"
    description: "Get metadata JSON without downloading media"
    use_cases:
      - "Pre-flight check before download"
      - "Building video indexes"

  extract_audio:
    file: "scripts/extract_audio.py"
    status: "stub"
    description: "Audio extraction wrapper"
    use_cases:
      - "Podcast/audio extraction for transcription"

# Configuration presets
configs:
  audio_only:
    file: "configs/audio-only.conf"
    description: "Extract best audio as mp3"
  video_720p:
    file: "configs/video-720p.conf"
    description: "Video capped at 720p"
  video_1080p:
    file: "configs/video-1080p.conf"
    description: "Video capped at 1080p"
  metadata_only:
    file: "configs/metadata-only.conf"
    description: "Extract metadata JSON, no download"

# Documentation references
documentation:
  readme: "README.md"
  claude_instructions: "CLAUDE.md"
  external:
    yt_dlp_github: "https://github.com/yt-dlp/yt-dlp"
    yt_dlp_options: "https://github.com/yt-dlp/yt-dlp#usage-and-options"
    supported_sites: "https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md"

# How this PBC connects to others
composability:
  role: "content_acquisition"
  status: "planned"
  feeds_into:
    - pbc: "rag-pipeline"
      interface: "Audio files for transcription -> text indexing"
      status: "planned"
  peer_capabilities:
    - pbc: "pbc-web-crawling"
      relationship: "Both acquire content for rag-pipeline"
